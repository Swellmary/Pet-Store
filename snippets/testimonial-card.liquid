{%- comment -%}
  Testimonial Card Snippet
  
  Usage:
  {% render 'testimonial-card',
    block: block,
    show_images: true,
    show_ratings: true,
    enable_animations: true,
    animation_style: 'fade-up',
    index: forloop.index
  %}
  
  Or standalone:
  {% render 'testimonial-card',
    quote: 'Amazing product!',
    author: 'John Doe',
    author_title: 'CEO',
    rating: 5,
    image: product.featured_image
  %}
{%- endcomment -%}

{%- liquid
  # Handle both block-based and standalone usage
  if block
    assign quote = block.settings.quote | escape | newline_to_br
    assign author = block.settings.author | escape
    assign author_title = block.settings.author_title | escape
    assign rating = block.settings.rating | default: 5
    assign image = block.settings.image
    assign link = block.settings.link
    assign block_attributes = block.shopify_attributes
  else
    assign quote = quote | escape | newline_to_br
    assign author = author | escape
    assign author_title = author_title | escape
    assign rating = rating | default: 5
    assign block_attributes = ''
  endif
  
  # Animation classes
  assign animation_class = ''
  if enable_animations
    assign animation_class = 'testimonial-card--animated testimonial-card--' | append: animation_style
  endif
  
  # Calculate animation delay based on index
  assign animation_delay = index | times: 0.1
-%}

<figure 
  class="testimonial-card {{ animation_class }}"
  role="listitem"
  style="--animation-delay: {{ animation_delay }}s;"
  {{ block_attributes }}
>
  <div class="testimonial-card__inner">
    
    <!-- Quote Icon -->
    <div class="testimonial-card__quote-icon" aria-hidden="true">
      <svg width="40" height="40" viewBox="0 0 40 40" fill="currentColor">
        <path d="M12.5 20H7.5C6.83696 20 6.20107 19.7366 5.73223 19.2678C5.26339 18.7989 5 18.163 5 17.5V12.5C5 11.837 5.26339 11.2011 5.73223 10.7322C6.20107 10.2634 6.83696 10 7.5 10H12.5C13.163 10 13.7989 10.2634 14.2678 10.7322C14.7366 11.2011 15 11.837 15 12.5V25C15 26.3261 14.4732 27.5979 13.5355 28.5355C12.5979 29.4732 11.3261 30 10 30" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M32.5 20H27.5C26.837 20 26.2011 19.7366 25.7322 19.2678C25.2634 18.7989 25 18.163 25 17.5V12.5C25 11.837 25.2634 11.2011 25.7322 10.7322C26.2011 10.2634 26.837 10 27.5 10H32.5C33.163 10 33.7989 10.2634 34.2678 10.7322C34.7366 11.2011 35 11.837 35 12.5V25C35 26.3261 34.4732 27.5979 33.5355 28.5355C32.5979 29.4732 31.3261 30 30 30" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    
    <!-- Star Rating -->
    {% if show_ratings %}
      <div class="testimonial-card__rating" aria-label="Rating: {{ rating }} out of 5 stars">
        {% for i in (1..5) %}
          <span class="testimonial-card__star {% if i <= rating %}testimonial-card__star--filled{% endif %}" aria-hidden="true">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M10 15.27L16.18 19l-1.64-7.03L20 7.24l-7.19-.61L10 0 7.19 6.63 0 7.24l5.46 4.73L3.82 19z"/>
            </svg>
          </span>
        {% endfor %}
      </div>
    {% endif %}
    
    <!-- Quote Content -->
    <blockquote class="testimonial-card__quote">
      <p>"{{ quote }}"</p>
    </blockquote>
    
    <!-- Author Section -->
    <figcaption class="testimonial-card__author">
      
      <!-- Author Image -->
      {% if show_images and image != blank %}
        <div class="testimonial-card__avatar">
          <img 
            src="{{ image | image_url: width: 100, height: 100, crop: 'center' }}"
            srcset="{{ image | image_url: width: 100 }} 1x, {{ image | image_url: width: 200 }} 2x"
            alt="{{ author }}"
            width="56"
            height="56"
            loading="lazy"
            class="testimonial-card__avatar-image"
          >
        </div>
      {% elsif show_images %}
        <!-- Placeholder Avatar -->
        <div class="testimonial-card__avatar testimonial-card__avatar--placeholder">
          <span aria-hidden="true">{{ author | slice: 0 | upcase }}</span>
        </div>
      {% endif %}
      
      <!-- Author Info -->
      <div class="testimonial-card__author-info">
        {% if link != blank %}
          <a 
            href="{{ link | url_param_escape }}" 
            class="testimonial-card__author-name testimonial-card__author-name--link"
          >
            <cite>{{ author }}</cite>
          </a>
        {% else %}
          <cite class="testimonial-card__author-name">{{ author }}</cite>
        {% endif %}
        
        {% if author_title != blank %}
          <span class="testimonial-card__author-title">{{ author_title }}</span>
        {% endif %}
      </div>
      
    </figcaption>
    
  </div>
</figure>